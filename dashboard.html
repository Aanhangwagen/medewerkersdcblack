<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <div class="header">
        <button class="menuButton" id="menuToggle">&#9776;</button>
        <h1 id="welcomeMessage"></h1>
        <button id="signOut" class="signOutButton">Sign Out</button>
    </div>

    <div class="sidebar" id="sidebarMenu">
        <a href="./openstaandeindex.html">Openstaande Reports</a>
        <a href="#">Afgehandelde Reports</a>
        <a href="./employeedashboard.html">Werknemers</a>
    </div>

    <div class="dashboard-container">
        <div class="report-container">
            <div class="card-container">
                <div class="card-title">Afgewerkte reports:</div>
                <div class="card-count" id="cardCount">Loading...</div>
            </div>

            <div class="latest-report-container">
                <div class="latest-report-title">Laatste report:</div>
                <div class="latest-report-content" id="latestReport">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        const username = localStorage.getItem('username');

        if (!username) {
            window.location.href = 'login.html';
        } else {
            document.getElementById('welcomeMessage').textContent = `Welkom ${username}`;
        }

        document.getElementById('signOut').addEventListener('click', () => {
            localStorage.removeItem('username');
            window.location.href = 'login.html';
        });

        document.getElementById('menuToggle').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebarMenu');
            sidebar.classList.toggle('open');
            document.querySelector('.dashboard-container').classList.toggle('shift');
        });

        // Trello API credentials
        const apiKey = '5f862665847c0e4c47752f7eb60180a0'; // Replace with your API Key
        const token = 'ATTA44371dd8a9370e2d6c74a24216ccfb11aaf2b41a292ebd1ac1665f76ec021863D4DB276B'; // Replace with your API Token
        const boardId = 'q7CGaxf7'; // Replace with your Board ID
        const listId = '6617abf0b6c144203eba1051'; // Replace with your List ID

        // Fetch the number of cards and the latest card title from a specific list
        async function fetchCardData() {
            try {
                // Fetch all cards from the board
                const response = await fetch(`https://api.trello.com/1/boards/${boardId}/cards?key=${apiKey}&token=${token}`);
                const cards = await response.json();

                // Filter cards by list ID
                const filteredCards = cards.filter(card => card.idList === listId);
                const cardCount = filteredCards.length;

                // Get the latest card
                const latestCard = filteredCards.sort((a, b) => new Date(b.dateLastActivity) - new Date(a.dateLastActivity))[0];
                const latestCardTitle = latestCard ? latestCard.name : 'No cards';

                document.getElementById('cardCount').textContent = cardCount;
                document.getElementById('latestReport').textContent = latestCardTitle;
            } catch (err) {
                console.error('Error fetching Trello cards:', err);
                document.getElementById('cardCount').textContent = 'Error';
                document.getElementById('latestReport').textContent = 'Error';
            }
        }

        fetchCardData();
    </script>
</body>
</html>
